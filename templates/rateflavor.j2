{% extends "base.j2" %}
{% block title %}Flavors{% endblock %}
{% block active_flavor %}active{% endblock %}
{% block main %}
<div>
  <div class="table-responsive">
  <table class="table table-hover">
    <thead class="thead-light">
      <tr>
        <th scope="col">Flavor</th>
        <th scope="col">Type</th>
        <th scope="col">Sugar Free</th>
        <th scope="col">Average Rating</th>
        <th scope="col">Rate Me</th>
      </tr>
    </thead>
    <tbody>
      {% if flavors %}
        {% for flavor in flavors %}
          <tr>
            <td data-toggle="collapse" data-target="#{{flavor.flavor}}" class="clickable">{{flavor.flavor}}</td>
            {% if flavor.isSherbet %}
                <td data-toggle="collapse" data-target="#{{flavor.flavor}}" class="clickable">Sherbet</td>
            {% else %}
                <td data-toggle="collapse" data-target="#{{flavor.flavor}}" class="clickable">Ice cream</td>
            {% endif %}
            {% if flavor.isSugarFree %}
                <td data-toggle="collapse" data-target="#{{flavor.flavor}}" class="clickable">Sugar Free</td>
            {% else %}
                <td data-toggle="collapse" data-target="#{{flavor.flavor}}" class="clickable">Contains Sugar</td>
            {% endif %}
            {% if avgRatings %}
              {% if avgRatings.get(flavor.flavor) == "NA" %}
                <td>NA</td>
              {% else %}
                <td>{{avgRatings.get(flavor.flavor)}}/5</td>
              {% endif %}
            {% endif %}
            <td>
              <button type="button" name="{{flavor.flavor}}" data-toggle="modal" data-target="#modalRate">Rate Me!</button>
            </td>
          </tr>
          {% if rankings %}
          <tr>
              <td colspan="3">
                  <div id="{{flavor.flavor}}" class="collapse">
                    <table>
                      <tr>
                        <th>User</th>
                        <th>Rating</th>
                        <th>Comment</th>
                      </tr>
                      {% for ranking in rankings %} 
                      <tr>
                        {% if ranking.flavor == flavor.flavor %}
                            <td>{{ranking.user}}</td>
                            <td>{{ranking.rating}}/5</td>
                            <td>{{ranking.comment}}</td>
                        {% endif %}
                      </tr>
                      {% endfor %}
                    </table>
                  </div>
              </td>
          </tr>
          {% endif %}
        {% endfor %}
      {% else %}
        <td colspan="5">No flavors currently</td>
      {% endif %}
    </tbody>
  </table>
</div>
{% include "/modal_rate.j2" %}
{% endblock %}
